# :fa-brands fa-github: é…ç½® GitHub ä»£ç†
> ç»å¤§éƒ¨åˆ†ä»“åº“å’Œè„šæœ¬éƒ½æ‰˜ç®¡äº [GitHub](https://github.com) ä¸Šï¼Œç”±äºå›½å†…ç½‘ç»œç¯å¢ƒæ— æ³•æ­£å¸¸è®¿é—® [GitHub](https://github.com ':disabled') å› æ­¤éœ€è¦é…ç½®ä»£ç†å·²æ»¡è¶³ä½¿ç”¨ï¼Œæœ¬ç¯‡æä¾›ä¸‰ç§æ–¹å¼å¯è‡ªè¡Œé€‰æ‹©

> [!TIP|label:å°è´´å£«]
> æœ‰é­”æ³•çš„æœ‹å‹è¯·å¿½ç•¥æœ¬ç¯‡å†…å®¹

ã…¤

***

## FastGit å…¬å…±ä»£ç†
> å®˜æ–¹ç½‘ç«™ï¼š[https://fastgit.org](https://fastgit.org)\
> å®˜æ–¹æ–‡æ¡£ï¼š[https://doc.fastgit.org/zh-cn/guide.html](https://doc.fastgit.org/zh-cn/guide.html)

> [!TIP|label:ä½¿ç”¨å»ºè®®]
> æä¾›é«˜è´¨é‡å…è´¹å…¬å…±ä»£ç†çš„æœåŠ¡å™¨é¢ä¸´ç€å·¨å¤§çš„æµé‡å‹åŠ›ï¼Œè€Œäº‹å®ä¸Šä½œè€…éƒ½åœ¨ç”¨çˆ±å‘ç”µæ”¶åˆ°çš„æåŠ©å¯èƒ½å¾ˆå°‘\
> ä½œä¸ºç¾Šæ¯›åœˆç”¨æˆ·åº”æ‡‚å¾—çæƒœï¼Œè‡ªç”¨å³å¯ä¸è¦å¤§è‚†å®£ä¼ æ›´ä¸å¾—æ»¥ç”¨ï¼Œè‹¥è‡ªèº«æœ‰æ¡ä»¶åˆ™åº”ä¼˜å…ˆä½¿ç”¨è‡ªå»ºä»£ç†

- ### ä½¿ç”¨æ–¹æ³• <!-- {docsify-ignore} -->

    - ä»“åº“åœ°å€

        > å°†åŸé“¾æ¥ä¸­çš„ `github.com` æ›¿æ¢ä¸º `hub.fastgit.xyz`

    ?> ç¤ºä¾‹ï¼š[https://hub.fastgit.xyz/author/repo](https://hub.fastgit.xyz/author/repo ':disabled')

    - Raw åœ°å€

        > å°†åŸé“¾æ¥ä¸­çš„ `raw.githubusercontent.com` æ›¿æ¢ä¸º `raw.fastgit.org`

    ?> ç¤ºä¾‹ï¼š[https://raw.fastgit.org/author/repo/main/example.js](https://raw.fastgit.org/author/repo/main/example.js ':disabled')

ã…¤

***

## Socks5 è‡ªå»ºä»£ç†

> [!NOTE|label:å¿…è¦æ¡ä»¶]
> éœ€è¦ä¸€å°èƒ½å¤Ÿç›´æ¥è®¿é—® [GitHub](https://github.com) çš„è®¾å¤‡

> [!ATTENTION]
> **Socks5** ä»£ç†ç‰¹å¾æ˜æ˜¾å®¹æ˜“è¢«å¢™ï¼Œ**å¼ºçƒˆå»ºè®®** é…åˆ **IPé™åˆ¶ç­–ç•¥** ä½¿ç”¨ï¼Œå³é…ç½®æœåŠ¡ç«¯å£ä»…å…è®¸æ‚¨è®¾å¤‡çš„æµé‡é€šè¿‡ï¼Œé™åˆ¶åä¼šéå¸¸ç¨³å®š

- ### æ‡’äººéƒ¨ç½²æ–¹æ³• <!-- {docsify-ignore} -->

    > åœ¨æœåŠ¡ç«¯é€šè¿‡ Docker CLI ä¸€é”®å¯åŠ¨ **Socks5** ä»£ç†å®¹å™¨

    ```bash
    docker run -d -p <è‡ªå®šä¹‰ç«¯å£å·>:1080 \
    -e PROXY_USER=<è‡ªå®šä¹‰ç”¨æˆ·å> \
    -e PROXY_PASSWORD=<è‡ªå®šä¹‰å¯†ç > \
    -e PROXY_SERVER=0.0.0.0:1080 \
    --name socks5 \
    --restart always \
    xkuma/socks5
    ```
    > ä¸ä¸€å®šå¿…é¡»ä½¿ç”¨æ­¤æ–¹æ³•éƒ¨ç½² Socks5 ä»£ç†æœåŠ¡ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„

- ### é…ç½®æ–¹æ³• <!-- {docsify-ignore} -->

    > é…ç½® git åŸºäº [https://github.com](https://github.com ':disabled') åŸŸåçš„å…¨å±€ä»£ç†ï¼Œè¯·åœ¨å®¹å™¨å†…æ‰§è¡Œ

    ```bash
    git config --global http.https://github.com.proxy socks5h://<ç”¨æˆ·å>:<å¯†ç >@<åœ°å€>:<ç«¯å£>
    git config --global https.https://github.com.proxy socks5h://<ç”¨æˆ·å>:<å¯†ç >@<åœ°å€>:<ç«¯å£>
    ```
    > [!NOTE]
    > åœ°å€ç¤ºä¾‹ï¼š[socks5h://user:password@127.0.0.1:1080](http://127.0.0.1:1080 ':disabled')\
    > å¦‚æœæ²¡æœ‰é…ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆæŠŠå…¶ä¸­çš„ç”¨æˆ·åå’Œå¯†ç å»æ‰å³å¯ï¼Œå³ [socks5h://127.0.0.1:1080](http://127.0.0.1:1080 ':disabled')

    - #### å–æ¶ˆé…ç½®æ–¹æ³•

        ```bash
        git config --global --unset http.proxy && git config --global --unset https.proxy
        ```

- ### ä½¿ç”¨æ–¹æ³• <!-- {docsify-ignore} -->

?> é…ç½®åå³ä»£è¡¨å·²å…¨å±€ä»£ç† [GitHub](https://github.com ':disabled')ï¼Œæ— éœ€å¯¹é“¾æ¥è¿›è¡Œå¤„ç†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤ä»£ç†ä»…ä½œç”¨äºæ‹‰å–ä»“åº“ä¸Šï¼Œæ— æ³•åœ¨å•ç‹¬æ‹‰å–è„šæœ¬æ—¶ä½¿ç”¨

ã…¤

***

## Cloudflare è‡ªå»ºä»£ç†

> è¯¥æ–¹æ³•éƒ¨ç½²ç®€å•å¹¶ä¸”å¯ä»¥å®Œå…¨ç™½å«–ï¼Œ[Cloudflare](https://www.cloudflare.com/zh-cn) æ˜¯ä¸€å®¶å›½é™…çŸ¥åçš„CDNæœåŠ¡å•†

> [!TIP|label:å°è´´å£«]
> ä½¿ç”¨å¤œé—´ä¸»é¢˜æŸ¥çœ‹æœ¬é¡µå›¾ç‰‡æ•ˆæœæ›´ä½³ï¼ˆå³ä¸Šè§’å›¾æ ‡ï¼‰

- ### æ³¨å†Œ Cloudflare <!-- {docsify-ignore} -->

?> å¦‚æœå·²æœ‰æ³¨å†Œè´¦å·åˆ™å¿½ç•¥è¯¥æ­¥éª¤ï¼Œç›´æ¥åˆ›å»º

> æ³¨å†Œé“¾æ¥ï¼šhttps://dash.cloudflare.com/sign-up

> å¯èƒ½éƒ¨åˆ†åœ°åŒºå®˜ç½‘è®¿é—®è¾ƒæ…¢ï¼Œæ³¨å†Œè´¦å·éœ€è¦é‚®ä»¶éªŒè¯

- ### åˆ›å»º Workers <!-- {docsify-ignore} -->

    - #### 1. è¿›å…¥é¢æ¿ç‚¹å‡»åˆ›å»ºæœåŠ¡ <!-- {docsify-ignore} -->

        ![1](../img/proxy/1.png)\
        ![2](../img/proxy/2.png ':size=1050x450')

    - #### 2. è‡ªè¡Œå®šä¹‰ç½‘ç«™å‰ç¼€å <!-- {docsify-ignore} -->

        ![3](../img/proxy/3.jpeg ':size=1050x450')
        ![4](../img/proxy/4.png ':size=1050x150')

    - #### 3. åˆ›å»ºåç‚¹å‡»å¿«é€Ÿç¼–è¾‘ <!-- {docsify-ignore} -->

        ![5](../img/proxy/5.png ':size=1050x450')

    - #### 4. å¤åˆ¶ä¸‹é¢çš„ä»£ç ï¼Œè¦†ç›–åŸæœ‰é»˜è®¤å†…å®¹ <!-- {docsify-ignore} -->

        <div style='color: var(--themeColor);font-style: italic;'>
        <details>

        <summary>ç‚¹å‡»æ­¤å¤„å±•å¼€ä»£ç  ğŸ‘ˆ</summary>

        ```javascript
        'use strict'
        
        /**
         * static files (404.html, sw.js, conf.js)
         */
        const ASSET_URL = 'https://github.com/'
        // å‰ç¼€ï¼Œå¦‚æœè‡ªå®šä¹‰è·¯ç”±ä¸ºexample.com/gh/*ï¼Œå°†PREFIXæ”¹ä¸º '/gh/'ï¼Œæ³¨æ„ï¼Œå°‘ä¸€ä¸ªæ éƒ½ä¼šé”™ï¼
        const PREFIX = '/'
        // gitä½¿ç”¨cnpmjsé•œåƒã€åˆ†æ”¯æ–‡ä»¶ä½¿ç”¨jsDelivré•œåƒçš„å¼€å…³ï¼Œ0ä¸ºå…³é—­ï¼Œé»˜è®¤å¼€å¯
        const Config = {
            jsdelivr: 0,
            cnpmjs: 0
        }
        
        /** @type {RequestInit} */
        const PREFLIGHT_INIT = {
            status: 204,
            headers: new Headers({
                'access-control-allow-origin': '*',
                'access-control-allow-methods': 'GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS',
                'access-control-max-age': '1728000',
            }),
        }
        
        const exp1 = /^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:releases|archive)\/.*$/i
        const exp2 = /^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:blob|raw)\/.*$/i
        const exp3 = /^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:info|git-).*$/i
        const exp4 = /^(?:https?:\/\/)?raw\.(?:githubusercontent|github)\.com\/.+?\/.+?\/.+?\/.+$/i
        const exp5 = /^(?:https?:\/\/)?gist\.(?:githubusercontent|github)\.com\/.+?\/.+?\/.+$/i
        
        /**
         * @param {any} body
         * @param {number} status
         * @param {Object<string, string>} headers
         */
        function makeRes(body, status = 200, headers = {}) {
            headers['access-control-allow-origin'] = '*'
            return new Response(body, {status, headers})
        }
        
        /**
         * @param {string} urlStr
         */
        function newUrl(urlStr) {
            try {
                return new URL(urlStr)
            } catch (err) {
                return null
            }
        }
        
        addEventListener('fetch', e => {
            const ret = fetchHandler(e)
                .catch(err => makeRes('cfworker error:\n' + err.stack, 502))
            e.respondWith(ret)
        })
        
        function checkUrl(u) {
            for (let i of [exp1, exp2, exp3, exp4, exp5, ]) {
                if (u.search(i) === 0) {
                    return true
                }
            }
            return false
        }
        
        /**
         * @param {FetchEvent} e
         */
        async function fetchHandler(e) {
            const req = e.request
            const urlStr = req.url
            const urlObj = new URL(urlStr)
            let path = urlObj.searchParams.get('q')
            if (path) {
                return Response.redirect('https://' + urlObj.host + PREFIX + path, 301)
            }
            // cfworker ä¼šæŠŠè·¯å¾„ä¸­çš„ `//` åˆå¹¶æˆ `/`
            path = urlObj.href.substr(urlObj.origin.length + PREFIX.length).replace(/^https?:\/+/, 'https://')
            if (path.search(exp1) === 0 || path.search(exp5) === 0 || !Config.cnpmjs && (path.search(exp3) === 0 || path.search(exp4) === 0)) {
                return httpHandler(req, path)
            } else if (path.search(exp2) === 0) {
                if (Config.jsdelivr) {
                    const newUrl = path.replace('/blob/', '@').replace(/^(?:https?:\/\/)?github\.com/, 'https://cdn.jsdelivr.net/gh')
                    return Response.redirect(newUrl, 302)
                } else {
                    path = path.replace('/blob/', '/raw/')
                    return httpHandler(req, path)
                }
            } else if (path.search(exp3) === 0) {
                const newUrl = path.replace(/^(?:https?:\/\/)?github\.com/, 'https://github.com.cnpmjs.org')
                return Response.redirect(newUrl, 302)
            } else if (path.search(exp4) === 0) {
                const newUrl = path.replace(/(?<=com\/.+?\/.+?)\/(.+?\/)/, '@$1').replace(/^(?:https?:\/\/)?raw\.(?:githubusercontent|github)\.com/, 'https://cdn.jsdelivr.net/gh')
                return Response.redirect(newUrl, 302)
            } else {
                return fetch(ASSET_URL + path)
            }
        }
        
        /**
         * @param {Request} req
         * @param {string} pathname
         */
        function httpHandler(req, pathname) {
            const reqHdrRaw = req.headers
        
            // preflight
            if (req.method === 'OPTIONS' &&
                reqHdrRaw.has('access-control-request-headers')
            ) {
                return new Response(null, PREFLIGHT_INIT)
            }
        
            const reqHdrNew = new Headers(reqHdrRaw)
        
            let urlStr = pathname
            if (urlStr.startsWith('github')) {
                urlStr = 'https://' + urlStr
            }
            const urlObj = newUrl(urlStr)
        
            /** @type {RequestInit} */
            const reqInit = {
                method: req.method,
                headers: reqHdrNew,
                redirect: 'manual',
                body: req.body
            }
            return proxy(urlObj, reqInit)
        }
        
        /**
         *
         * @param {URL} urlObj
         * @param {RequestInit} reqInit
         */
        async function proxy(urlObj, reqInit) {
            const res = await fetch(urlObj.href, reqInit)
            const resHdrOld = res.headers
            const resHdrNew = new Headers(resHdrOld)
        
            const status = res.status
        
            if (resHdrNew.has('location')) {
                let _location = resHdrNew.get('location')
                if (checkUrl(_location))
                    resHdrNew.set('location', PREFIX + _location)
                else {
                    reqInit.redirect = 'follow'
                    return proxy(newUrl(_location), reqInit)
                }
            }
            resHdrNew.set('access-control-expose-headers', '*')
            resHdrNew.set('access-control-allow-origin', '*')
        
            resHdrNew.delete('content-security-policy')
            resHdrNew.delete('content-security-policy-report-only')
            resHdrNew.delete('clear-site-data')
        
            return new Response(res.body, {
                status,
                headers: resHdrNew,
            })
        }
        ```

        </details>
        </div>

        ![6](../img/proxy/6.png ':size=1050x450')

    - #### 5. æµ‹è¯•è¯·æ±‚æ˜¯å¦åä»£æˆåŠŸ <!-- {docsify-ignore} -->

        ![7](../img/proxy/7.png ':size=1050x450')
        ![8](../img/proxy/8.png ':size=1050x450')

    - #### 6. ä¿å­˜å¹¶éƒ¨ç½² <!-- {docsify-ignore} -->

        ![9](../img/proxy/9.png)\
        ![10](../img/proxy/10.png)

        > åˆ°è¿™é‡Œå°±æ­å»ºå®Œæˆäº†ï¼Œæ‚¨çš„ä»£ç†æ˜¯ `https://<æœåŠ¡å>.<ç”¨æˆ·å>.workers.dev/`

- ### ä½¿ç”¨æ–¹æ³• <!-- {docsify-ignore} -->

    > åœ¨åŸæœ‰é“¾æ¥åœ°å€å‰é¢åŠ ä¸Šæ‚¨çš„ä»£ç†åœ°å€ï¼Œä¾‹å¦‚ [https://github.user.workers.dev/https://github.com/User/Repo.git](https://github.com ':disabled')
